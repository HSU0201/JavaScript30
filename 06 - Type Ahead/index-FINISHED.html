<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="https://fav.farm/âœ…" />
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
<script>
const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

// å®šç¾©ä¸€å€‹ç©ºçš„åŸå¸‚é™£åˆ—
const cities = [];

// å¾æŒ‡å®šçš„ endpoint ç²å–æ•¸æ“šï¼Œä¸¦è§£ææˆ JSON æ ¼å¼å¾Œå°‡æ•¸æ“šæ·»åŠ åˆ°åŸå¸‚é™£åˆ—ä¸­
fetch(endpoint)
  .then(blob => blob.json()) // å°‡ç²å–åˆ°çš„æ•¸æ“š blob è§£æç‚º JSON
  .then(data => cities.push(...data)); // å°‡è§£æå‡ºçš„æ•¸æ“šå±•é–‹ä¸¦æ·»åŠ åˆ° cities é™£åˆ—ä¸­

// å®šç¾©ä¸€å€‹å‡½æ•¸ï¼Œç”¨æ–¼æ ¹æ“šè¼¸å…¥çš„å–®è©åœ¨åŸå¸‚æ•¸æ“šä¸­æŸ¥æ‰¾åŒ¹é…çš„é …ç›®
function findMatches(wordToMatch, cities) {
  return cities.filter(place => {
    // å‰µå»ºä¸€å€‹æ­£å‰‡è¡¨é”å¼ï¼Œç”¨æ–¼é€²è¡Œä¸å€åˆ†å¤§å°å¯«çš„åŒ¹é…
    const regex = new RegExp(wordToMatch, 'gi');
    // è¿”å› city æˆ– state èˆ‡è¼¸å…¥å–®è©åŒ¹é…çš„é …ç›®
    return place.city.match(regex) || place.state.match(regex);
  });
}

// å®šç¾©ä¸€å€‹å‡½æ•¸ï¼Œç”¨æ–¼å°‡æ•¸å­—æ ¼å¼åŒ–ç‚ºå¸¶æœ‰é€—è™Ÿåˆ†éš”çš„å½¢å¼
function numberWithCommas(x) {
  return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

// å®šç¾©ä¸€å€‹å‡½æ•¸ï¼Œç”¨æ–¼é¡¯ç¤ºåŒ¹é…çš„çµæœ
function displayMatches() {
  // ç²å–èˆ‡è¼¸å…¥å€¼åŒ¹é…çš„åŸå¸‚æ•¸æ“š
  const matchArray = findMatches(this.value, cities);
  // ç”ŸæˆåŒ¹é…é …ç›®çš„ HTML çµæ§‹
  const html = matchArray.map(place => {
    // å‰µå»ºä¸€å€‹æ­£å‰‡è¡¨é”å¼ï¼Œç”¨æ–¼é«˜äº®é¡¯ç¤ºåŒ¹é…çš„éƒ¨åˆ†
    const regex = new RegExp(this.value, 'gi');
    // å°‡åŒ¹é…çš„åŸå¸‚åç¨±éƒ¨åˆ†æ›¿æ›ç‚ºå¸¶æœ‰ <span> æ¨™ç±¤çš„é«˜äº®é¡¯ç¤ºå½¢å¼
    const cityName = place.city.replace(regex, `<span class="hl">${this.value}</span>`);
    // å°‡åŒ¹é…çš„å·åç¨±éƒ¨åˆ†æ›¿æ›ç‚ºå¸¶æœ‰ <span> æ¨™ç±¤çš„é«˜äº®é¡¯ç¤ºå½¢å¼
    const stateName = place.state.replace(regex, `<span class="hl">${this.value}</span>`);
    // è¿”å›æ¯å€‹åŒ¹é…é …ç›®çš„ HTML çµæ§‹
    return `
      <li>
        <span class="name">${cityName}, ${stateName}</span>
        <span class="population">${numberWithCommas(place.population)}</span>
      </li>
    `;
  }).join(''); // å°‡æ‰€æœ‰åŒ¹é…é …ç›®é€£æ¥æˆä¸€å€‹å®Œæ•´çš„ HTML å­—ç¬¦ä¸²
  // å°‡ç”Ÿæˆçš„ HTML çµæ§‹æ’å…¥åˆ° suggestions å…ƒç´ ä¸­
  suggestions.innerHTML = html;
}

// ç²å– DOM ä¸­çš„æœç´¢è¼¸å…¥æ¡†å’Œå»ºè­°åˆ—è¡¨å…ƒç´ 
const searchInput = document.querySelector('.search');
const suggestions = document.querySelector('.suggestions');

// ç‚ºæœç´¢è¼¸å…¥æ¡†æ·»åŠ äº‹ä»¶ç›£è½å™¨ï¼Œåœ¨å…§å®¹è®Šæ›´æ™‚è§¸ç™¼ displayMatches å‡½æ•¸
searchInput.addEventListener('change', displayMatches);
// ç‚ºæœç´¢è¼¸å…¥æ¡†æ·»åŠ äº‹ä»¶ç›£è½å™¨ï¼Œåœ¨æŒ‰éµé‡‹æ”¾æ™‚è§¸ç™¼ displayMatches å‡½æ•¸
searchInput.addEventListener('keyup', displayMatches);


</script>
  </body>
</html>
